
ol.Overlay.Popup=function(c){var a=c||{};this.panMapIfOutOfView=a.panMapIfOutOfView;if(this.panMapIfOutOfView===undefined){this.panMapIfOutOfView=true}this.ani=a.ani;if(this.ani===undefined){this.ani=ol.animation.pan}this.ani_opts=a.ani_opts;if(this.ani_opts===undefined){this.ani_opts={duration:250}}this.container=document.createElement("div");this.container.className="ol-popup";this.closer=document.createElement("a");this.closer.className="ol-popup-closer";this.closer.href="#";this.container.appendChild(this.closer);var b=this;this.closer.addEventListener("click",function(d){b.container.style.display="none";b.closer.blur();d.preventDefault()},false);this.content=document.createElement("div");this.content.className="ol-popup-content";this.container.appendChild(this.content);ol.Overlay.Popup.enableTouchScroll_(this.content);ol.Overlay.call(this,{element:this.container,stopEvent:true,insertFirst:(a.hasOwnProperty("insertFirst"))?a.insertFirst:true})};ol.inherits(ol.Overlay.Popup,ol.Overlay);ol.Overlay.Popup.prototype.show=function(b,a){this.setPosition(b);this.content.innerHTML=a;this.container.style.display="block";if(this.panMapIfOutOfView){this.panIntoView_(b)}this.content.scrollTop=0;return this};ol.Overlay.Popup.prototype.panIntoView_=function(h){var d={width:this.getElement().clientWidth+20,height:this.getElement().clientHeight+20},g=this.getMap().getSize();var e=20,i=60,c=d.width-i,n=this.getOffset(),k=this.getMap().getPixelFromCoordinate(h);var l=(k[0]-i),b=g[0]-(k[0]+c);var o=k[1]-d.height+n[1],f=g[1]-(k[1]+e)-n[1];var a=this.getMap().getView().getCenter(),j=this.getMap().getPixelFromCoordinate(a),m=j.slice();if(b<0){m[0]-=b}else{if(l<0){m[0]+=l}}if(o<0){m[1]+=o}else{if(f<0){m[1]-=f}}if(this.ani&&this.ani_opts){this.ani_opts.source=a;this.getMap().beforeRender(this.ani(this.ani_opts))}if(m[0]!==j[0]||m[1]!==j[1]){this.getMap().getView().setCenter(this.getMap().getCoordinateFromPixel(m))}return this.getMap().getView().getCenter()};ol.Overlay.Popup.isTouchDevice_=function(){try{document.createEvent("TouchEvent");return true}catch(a){return false}};ol.Overlay.Popup.enableTouchScroll_=function(b){if(ol.Overlay.Popup.isTouchDevice_()){var a=0;b.addEventListener("touchstart",function(c){a=this.scrollTop+c.touches[0].pageY},false);b.addEventListener("touchmove",function(c){this.scrollTop=a-c.touches[0].pageY},false)}};ol.Overlay.Popup.prototype.hide=function(){this.container.style.display="none";return this};