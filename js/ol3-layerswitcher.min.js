
ol.control.LayerSwitcher=function(c){var a=c||{};var e=a.tipLabel?a.tipLabel:"Legend";this.mapListeners=[];this.hiddenClassName="ol-unselectable ol-control layer-switcher";this.shownClassName=this.hiddenClassName+" shown";var b=document.createElement("div");b.className=this.hiddenClassName;this.button=document.createElement("button");this.button.setAttribute("title",e);b.appendChild(this.button);this.panel=document.createElement("div");this.panel.className="panel";b.appendChild(this.panel);var d=this;b.onmouseover=function(f){d.showPanel()};this.button.onclick=function(f){d.showPanel()};b.onmouseout=function(f){f=f||window.event;if(!b.contains(f.toElement)){d.hidePanel()}};ol.control.Control.call(this,{element:b,target:a.target})};ol.inherits(ol.control.LayerSwitcher,ol.control.Control);ol.control.LayerSwitcher.prototype.showPanel=function(){if(this.element.className!=this.shownClassName){this.element.className=this.shownClassName;this.renderPanel();this.button.style.position="absolute";this.panel.style.maxHeight=(window.innerHeight-(ol.control.LayerSwitcher.convertEm(3.5,this.element)+2)*2)+"px"}};ol.control.LayerSwitcher.prototype.hidePanel=function(){if(this.element.className!=this.hiddenClassName){this.element.className=this.hiddenClassName;this.button.style.position=null}};ol.control.LayerSwitcher.prototype.renderPanel=function(){this.ensureTopVisibleBaseLayerShown_();while(this.panel.firstChild){this.panel.removeChild(this.panel.firstChild)}var a=document.createElement("ul");this.panel.appendChild(a);this.renderLayers_(this.getMap(),a)};ol.control.LayerSwitcher.prototype.setMap=function(c){for(var b=0,a;b<this.mapListeners.length;b++){this.getMap().unByKey(this.mapListeners[b])}this.mapListeners.length=0;ol.control.Control.prototype.setMap.call(this,c);if(c){var d=this;this.mapListeners.push(c.on("pointerdown",function(){d.hidePanel()}));this.renderPanel()}};ol.control.LayerSwitcher.prototype.ensureTopVisibleBaseLayerShown_=function(){var a;ol.control.LayerSwitcher.forEachRecursive(this.getMap(),function(d,b,c){if(d.get("type")==="base"&&d.getVisible()){a=d}});if(a){this.setVisible_(a,true)}};ol.control.LayerSwitcher.prototype.setVisible_=function(a,c){var b=this.getMap();a.setVisible(c);if(c&&a.get("type")==="base"){ol.control.LayerSwitcher.forEachRecursive(b,function(f,d,e){if(f!=a&&f.get("type")==="base"){f.setVisible(false)}})}if(c&&a.get("typeGroup")==="radio"){ol.control.LayerSwitcher.forEachRecursive2(b,a)}};ol.control.LayerSwitcher.prototype.renderLayer_=function(b,i,d){var c=this;var k=document.createElement("li");var j=b.get("title");var a=b.get("title").replace(/\s+/g,"-")+"_"+i;var m=b.get("tooltip")||"";var h=document.createElement("label");if(b.getLayers){if(!d){var g=document.createElement("input");var l=b.get("typeGroup");var e=b.get("titleGroup");if(l&&e&&l==="radio"){g.type=l;g.name=e}else{g.type="checkbox"}g.id=a;g.checked=b.get("visible");g.onchange=function(n){c.setVisible_(b,n.target.checked)};k.appendChild(g)}k.className="group";h.innerHTML=j;h.title=m;k.appendChild(h);var f=document.createElement("ul");k.appendChild(f);this.renderLayers_(b,f)}else{var g=document.createElement("input");if(b.get("type")==="base"){g.type="radio";g.name="base"}else{var l=b.get("typeGroup");var e=b.get("titleGroup");if(l&&e&&l==="radio"){g.type=l;g.name=e}else{g.type="checkbox"}}g.id=a;g.checked=b.get("visible");g.onchange=function(n){c.setVisible_(b,n.target.checked)};k.appendChild(g);h.htmlFor=a;h.innerHTML=j;h.title=m;k.appendChild(h)}return k};ol.control.LayerSwitcher.prototype.renderLayers_=function(c,g){var f=c.getLayers().getArray().slice().reverse();var e=null;var b=null;if(c instanceof ol.layer.Group){e=c.get("type")||null;b=c.get("title")}for(var d=0,a;d<f.length;d++){a=f[d];a.set("typeGroup",e);a.set("titleGroup",b);if(a.get("title")){g.appendChild(this.renderLayer_(a,d,c instanceof ol.Map))}if(!(c instanceof ol.Map)){a.set("parentLayer",c)}}};ol.control.LayerSwitcher.forEachRecursive=function(a,b){a.getLayers().forEach(function(e,c,d){b(e,c,d);if(e.getLayers){ol.control.LayerSwitcher.forEachRecursive(e,b)}})};ol.control.LayerSwitcher.forEachRecursive2=function(c,b){var a=c.getLayers().getArray();if(a.indexOf(b)!=-1){a.forEach(function(f,d,e){if(b!=f&&!!f.get("title")){f.setVisible(false)}})}else{a.forEach(function(f,d,e){if(f.getLayers){ol.control.LayerSwitcher.forEachRecursive2(f,b)}})}};ol.control.LayerSwitcher.getElementFontSize=function(a){return parseFloat(getComputedStyle(a||document.documentElement).fontSize)};ol.control.LayerSwitcher.convertRem=function(a){return ol.control.LayerSwitcher.convertEm(a)};ol.control.LayerSwitcher.convertEm=function(b,a){return b*ol.control.LayerSwitcher.getElementFontSize(a)};